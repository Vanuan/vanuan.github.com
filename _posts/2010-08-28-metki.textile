---
layout: default
published: true
title: Метки
---

h2. Общее описание и случайные мысли

Метки служат для группировки сообщений и группового управления представлением последних на сайте. Поля меток: имя метки, связь с настройками приватности.

Метки-родители служат для упрощения присваивания меток сообщению. Например, пользователь решил использовать метку "C++", но забыл использовать метку "программирование". Эта метка подразумевается автоматически, так как C++ связан с программированием. Или, например, вместо метки C++ в английской раскладке, пользователь по ошибке использовал букву "С" в русской раскладке. В результате по ошибке будет создана ещё одна метка, хотя на самом деле имеется в виду одно и то же понятие. И наконец, третий вариант использования связей между метками - локализованные метки. Пользователь в США, например, будет видеть метку как "programming", а пользователь в России - "программирование".

Метки впоследствии будут использоваться для создания навигации по сайту.

Существуют метки-синонимы (для предотвращения дубликатов) и метки-родители (для создания иерархической структуры).

Метка без родителя имеет специальное предназначение. Метка может иметь только одного родителя. В случае, если требуется включить статью в несколько разделов, ей присваивается несколько меток.

Специальные метки: приватность, категория сайта.

Метки приватности: опубликовано, приватное, скрытое (требуется прямая ссылка).

Метки-категории: трудовые будни, хобби, обо мне, ...

Итак, имеем 4 типа меток:

1. Метки-категории (подкатегории)
2. Метки-синонимы
3. Языковые метки
4. Метки приватности


h2. Use cases

* Присвоить метку записи
** Использовать существующую метку
*** Отобразить список меток
*** Отобразить список меток, начинающихся с заданной буквы
*** Выбрать метку
** Создать новую метку
*** Ввести имя метки
*** Установить связи между метками
* Отобразить записи по заданной метке
** Отобразить список меток
** Отобразить метку-категорию (все сообщения с заданной меткой, метками-синонимами заданной и метками, являющимися её потомками)
** Не отображать сообщения с приватной меткой незарегистрированным пользователям
** Отображать сообщения с приватной меткой зарегистрированным пользователям

h2. Проектирование

Отношение "Метки-приватность"

Отношение "Метки-категории" many-to-many. Каждая метка может входить в несколько категорий. Каждая категория может содержать сообщения с несколькими метками.

Отношение "Метки-синонимы" one-to-many. Каждая метка может иметь несколько синонимов. Каждый синоним имеет одну метку, синонимом которой является.

Следует создать интерфейс для управления метками.

А также helper link_to_label(labelname).

Модель данных для меток

table(with-borders){margin:auto}.
|_\2. Labels |
|_. имя поля|_. тип|
|id|integer|
|name|string|

Модель даннык для отношения метка-метка

Таблицы:

create_table "appearances", do |t|
  t.column "dancer_id",      :integer, :null => false
  t.column "movie_id",       :integer, :null => false
  t.column "character_name", :string
  t.column "dance_numbers",  :integer
end

Модели:

class Appearance < ActiveRecord::Base
  belongs_to :dancer
  belongs_to :movie
end

class Dancer < ActiveRecord::Base
  has_many :appearances, :dependent => true
  has_many :movies, :through => :appearances
end

class Movie < ActiveRecord::Base
  has_many :appearances, :dependent => true
  has_many :dancers, :through => :appearances
end

rails generate scaffold Label id:string
